
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>業務獎金計算</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #eef4fb; padding: 20px; }
    .container { max-width: 720px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 0 12px rgba(0,0,0,0.1); }
    input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; }
    button { background-color: #28a745; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #218838; }
    .highlight { font-weight: bold; font-size: 18px; color: #d00; }
  </style>
</head>
<body>
  <div class="container">
    <h2>業務獎金計算</h2>
    <p>每公斤底價：<span id="basePriceDisplay">-</span> 元</p>
    <label>業務姓名：<input type="text" id="salesName"></label>
    <label>銷售品名：<input type="text" id="productName"></label>
    <label>成交重量 (kg)：<input type="number" id="actualWeight"></label>
    <label>成交單價 (元/kg)：<input type="number" id="actualPrice"></label>
    <div>
      <label><input type="checkbox" id="homeDelivery"> 宅配（扣250元）</label>
      <label><input type="checkbox" id="selfDelivery"> 自行配送（每公斤加3元）</label>
      <label><input type="checkbox" id="companyDriver"> 公司司機（每公斤扣3元）</label>
      <label><input type="checkbox" id="kaohsiungLocal"> 高雄市區公司車（加5元）</label>
    </div>
    <button onclick="calculateBonus()">計算獎金</button>
    <p class="highlight">本次獎金：<span id="bonusResult">0</span> 元</p>
    <p>本月累積獎金：<span id="totalBonus">0</span> 元</p>
    <button onclick="exportCSV()">📄 匯出報價報表</button>
    <button onclick="goBack()">⬅ 返回主頁</button>
  </div>
<script>
  const base = parseFloat(localStorage.getItem("basePrice") || "0");
  let bonusData = JSON.parse(localStorage.getItem("monthlyBonus") || "[]");
  document.getElementById("basePriceDisplay").innerText = base.toFixed(0);
  updateTotal();

  function calculateBonus() {
    const actual = parseFloat(document.getElementById("actualPrice").value);
    const weight = parseFloat(document.getElementById("actualWeight").value);
    const sales = document.getElementById("salesName").value.trim();
    const product = document.getElementById("productName").value.trim();
    if (!sales || !product) return alert("請輸入業務姓名與銷售品名");
    const deduct = document.getElementById("homeDelivery").checked ? 250 : 0;
    const addSelf = document.getElementById("selfDelivery").checked ? weight * 3 : 0;
    const deductDriver = document.getElementById("companyDriver").checked ? weight * 3 : 0;
    const addKaohsiung = document.getElementById("kaohsiungLocal").checked ? 5 : 0;
    const diff = actual - base;
    const bonus = diff > 0 ? diff * weight - deduct - deductDriver + addSelf + addKaohsiung : 0;
    document.getElementById("bonusResult").innerText = bonus.toFixed(0);
    const total = actual * weight;
    bonusData.push({ date: new Date().toISOString().split("T")[0], name: sales, product, weight, price: actual, total, bonus: bonus.toFixed(0) });
    localStorage.setItem("monthlyBonus", JSON.stringify(bonusData));
    updateTotal();
  }

  function updateTotal() {
    const total = bonusData.reduce((sum, r) => sum + parseFloat(r.bonus), 0);
    document.getElementById("totalBonus").innerText = total.toFixed(0);
  }

  function exportCSV() {
    let csv = "業務姓名,銷售品名,數量(kg),成交單價,總金額,獎金,日期\n";
    bonusData.forEach(r => {
      csv += `${r.name},${r.product},${r.weight},${r.price},${r.total},${r.bonus},${r.date}\n`;
    });
    const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "業務獎金報價報表.csv";
    link.click();
  }

  function goBack() {
    window.location.href = "index.html";
  }
</script>
</body>
</html>
