
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ¥­å‹™çé‡‘è¨ˆç®—</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #eef4fb; padding: 20px; }
    .container { max-width: 720px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 0 12px rgba(0,0,0,0.1); }
    input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; }
    button { background-color: #28a745; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #218838; }
    .highlight { font-weight: bold; font-size: 18px; color: #d00; }
  </style>
</head>
<body>
  <div class="container">
    <h2>æ¥­å‹™çé‡‘è¨ˆç®—</h2>
    <p>æ¯å…¬æ–¤åº•åƒ¹ï¼š<span id="basePriceDisplay">-</span> å…ƒ</p>
    <label>æ¥­å‹™å§“åï¼š<input type="text" id="salesName"></label>
    <label>éŠ·å”®å“åï¼š<input type="text" id="productName"></label>
    <label>æˆäº¤é‡é‡ (kg)ï¼š<input type="number" id="actualWeight"></label>
    <label>æˆäº¤å–®åƒ¹ (å…ƒ/kg)ï¼š<input type="number" id="actualPrice"></label>
    <div>
      <label><input type="checkbox" id="homeDelivery"> å®…é…ï¼ˆæ‰£250å…ƒï¼‰</label>
      <label><input type="checkbox" id="selfDelivery"> è‡ªè¡Œé…é€ï¼ˆæ¯å…¬æ–¤åŠ 3å…ƒï¼‰</label>
      <label><input type="checkbox" id="companyDriver"> å…¬å¸å¸æ©Ÿï¼ˆæ¯å…¬æ–¤æ‰£3å…ƒï¼‰</label>
      <label><input type="checkbox" id="kaohsiungLocal"> é«˜é›„å¸‚å€å…¬å¸è»Šï¼ˆåŠ 5å…ƒï¼‰</label>
    </div>
    <button onclick="calculateBonus()">è¨ˆç®—çé‡‘</button>
    <p class="highlight">æœ¬æ¬¡çé‡‘ï¼š<span id="bonusResult">0</span> å…ƒ</p>
    <p>æœ¬æœˆç´¯ç©çé‡‘ï¼š<span id="totalBonus">0</span> å…ƒ</p>
    <button onclick="exportCSV()">ğŸ“„ åŒ¯å‡ºå ±åƒ¹å ±è¡¨</button>
    <button onclick="goBack()">â¬… è¿”å›ä¸»é </button>
  </div>
<script>
  const base = parseFloat(localStorage.getItem("basePrice") || "0");
  let bonusData = JSON.parse(localStorage.getItem("monthlyBonus") || "[]");
  document.getElementById("basePriceDisplay").innerText = base.toFixed(0);
  updateTotal();

  function calculateBonus() {
    const actual = parseFloat(document.getElementById("actualPrice").value);
    const weight = parseFloat(document.getElementById("actualWeight").value);
    const sales = document.getElementById("salesName").value.trim();
    const product = document.getElementById("productName").value.trim();
    if (!sales || !product) return alert("è«‹è¼¸å…¥æ¥­å‹™å§“åèˆ‡éŠ·å”®å“å");
    const deduct = document.getElementById("homeDelivery").checked ? 250 : 0;
    const addSelf = document.getElementById("selfDelivery").checked ? weight * 3 : 0;
    const deductDriver = document.getElementById("companyDriver").checked ? weight * 3 : 0;
    const addKaohsiung = document.getElementById("kaohsiungLocal").checked ? 5 : 0;
    const diff = actual - base;
    const bonus = diff > 0 ? diff * weight - deduct - deductDriver + addSelf + addKaohsiung : 0;
    document.getElementById("bonusResult").innerText = bonus.toFixed(0);
    const total = actual * weight;
    bonusData.push({ date: new Date().toISOString().split("T")[0], name: sales, product, weight, price: actual, total, bonus: bonus.toFixed(0) });
    localStorage.setItem("monthlyBonus", JSON.stringify(bonusData));
    updateTotal();
  }

  function updateTotal() {
    const total = bonusData.reduce((sum, r) => sum + parseFloat(r.bonus), 0);
    document.getElementById("totalBonus").innerText = total.toFixed(0);
  }

  function exportCSV() {
    let csv = "æ¥­å‹™å§“å,éŠ·å”®å“å,æ•¸é‡(kg),æˆäº¤å–®åƒ¹,ç¸½é‡‘é¡,çé‡‘,æ—¥æœŸ\n";
    bonusData.forEach(r => {
      csv += `${r.name},${r.product},${r.weight},${r.price},${r.total},${r.bonus},${r.date}\n`;
    });
    const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "æ¥­å‹™çé‡‘å ±åƒ¹å ±è¡¨.csv";
    link.click();
  }

  function goBack() {
    window.location.href = "index.html";
  }
</script>
</body>
</html>
